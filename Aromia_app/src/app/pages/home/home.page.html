<ion-header>
    <aromia-header [products]="products" (openCart)="setOpenCart($event)"></aromia-header>
</ion-header>

<ion-content [fullscreen]="true">

    <div class="banners">
        <div class="carousel-container">
            <div class="carousel-track" [style.transform]="'translateX(-' + (currentBannerIndex * 100) + '%)'">
                @for (banner of banners; track $index) {
                <div class="carousel-slide">


                    <div class="text">
                        <div class="logo">
                            <img [src]="banner.logo" alt="">
                        </div>

                        <p class="title">{{ banner.title }}</p>
                        <p class="subtitle">{{ banner.subtitle }}</p>
                    </div>

                    <img [src]="banner.img" [alt]="'Banner ' + ($index + 1)" />
                </div>
                }
            </div>
            <div class="carousel-indicators">
                @for (banner of banners; track $index) {
                <button class="indicator" [class.active]="currentBannerIndex === $index" (click)="goToBanner($index)"
                    [attr.aria-label]="'Ir a banner ' + ($index + 1)">
                </button>
                }
            </div>
        </div>
    </div>


    <div class="status-container">
        <h5 class="bold">Mis pedidos</h5>
        @if (orders.length === 0) {
        <div class="empty-state">
            <p>No tienes pedidos activos.</p>
        </div>
        }
        @for (order of orders; track order.id) {
        <div class="status" (click)="goToOrder(order.id)">
            <ion-item detail button lines="none">
                <ion-label>
                    <div class="flex-between">
                        <h3 class="bold color-dark">Pedido #{{ order.order_number }}</h3>
                        <h3 class="bold color-primary">{{ order.totalAmount | currency:'CRC':'symbol-narrow' }}</h3>
                    </div>
                    <p>Estado: <span class="bold color-danger">{{ order.status.name ?? 'Pendiente' }}</span> </p>
                </ion-label>
            </ion-item>

            <div class="progress-container">
                <div class="progress">
                    <div class="bar"
                        [class.active]="getOrderProgress(order.status) >= 1 || getOrderProgress(order.status) == null">
                    </div>
                    <div class="bar" [class.active]="getOrderProgress(order.status) >= 2"></div>
                    <div class="bar" [class.active]="getOrderProgress(order.status) >= 3"></div>
                    <div class="bar" [class.active]="getOrderProgress(order.status) >= 4"></div>
                    <div class="bar" [class.active]="getOrderProgress(order.status) >= 5"></div>
                </div>

            </div>
            <div style="margin-top: 6px;" class="date">
                <ion-chip color="primary" [outline]="false">{{ order.created_at | date:'dd MMM yy' }}</ion-chip>
            </div>
        </div>
        }
    </div>

    <div class="recommended-container">
        <h5 class="bold">Productos recomendados</h5>
        <div class="recommended-products">
            @for (product of recommendedProducts; track product.id) {
            <div class="product-card">
                <div class="product-image">
                    <img [src]="product.image_url" [alt]="product.name" />
                </div>
                <div class="product-info">
                    <h6 class="product-name">{{ product.name }}</h6>
                    <p class="product-price">â‚¡{{ product.price }}</p>
                </div>
            </div>
            }
        </div>
    </div>



</ion-content>
<ion-footer>
    <ion-button mode="ios" (click)="goTo()" expand="block">Ver productos</ion-button>
</ion-footer>

<ion-modal [isOpen]="isCartOpen">
    <ng-template>

        <ion-header>
            <ion-toolbar>
                <ion-buttons slot="end">
                    <ion-button (click)="setOpenCart(false)">Cerrar</ion-button>
                </ion-buttons>
            </ion-toolbar>
        </ion-header>
        <ion-content class="p-26">
            <aromia-cart (ready)="setOpenCart(!$event)"></aromia-cart>
        </ion-content>




    </ng-template>
</ion-modal>