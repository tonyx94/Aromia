<div class="clients-container">

    <div *ngIf="loading" class="loading-state">
        <div class="spinner"></div>
        <p>Cargando clientes...</p>
    </div>

    <div *ngIf="error && !loading" class="error-state">
        <p>{{ error }}</p>
        <button (click)="loadClients()" class="retry-btn">Reintentar</button>
    </div>

    <div *ngIf="!loading && !error" class="clients-layout">
        <div class="clients-list-panel">
            <div class="panel-header">
                <h2>Clientes</h2>
                <button *ngIf="searchTerm" (click)="clearSearch()" class="clear-filters-btn">
                    Limpiar búsqueda
                </button>
            </div>

            <div class="filters">
                <div class="filter-group">
                    <input type="text" [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange($event)"
                        placeholder="Buscar por nombre, email o teléfono..." class="search-input" />
                </div>
            </div>

            <div class="clients-list">
                <div *ngFor="let client of filteredClients$ | async" class="client-card"
                    [class.selected]="selectedClient?.id === client.id" (click)="selectClient(client)">
                    <div class="client-card-header">
                        <h3>{{ client.firstName }} {{ client.lastName }}</h3>
                        <span class="status-badge" [class.inactive]="!client.isActive">
                            {{ client.isActive ? 'Activo' : 'Inactivo' }}
                        </span>
                    </div>
                    <div class="client-card-body">
                        <p class="client-email">
                            <strong>Email:</strong> {{ client.email }}
                        </p>
                        <p class="client-phone">
                            <strong>Teléfono:</strong> {{ client.phone }}
                        </p>
                        <p class="client-date">
                            <strong>Registrado:</strong> {{ formatDate(client.createdAt) }}
                        </p>
                    </div>
                </div>

                <div *ngIf="(filteredClients$ | async)?.length === 0" class="empty-state">
                    <p>No se encontraron clientes</p>
                </div>
            </div>
        </div>

        <div class="client-details-panel">
            <div *ngIf="!selectedClient" class="no-selection">
                <svg width="120" height="120" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2" />
                    <circle cx="8.5" cy="7" r="4" />
                    <path d="M20 8v6M23 11h-6" />
                </svg>
                <p>Selecciona un cliente para ver los detalles</p>
            </div>

            <div *ngIf="selectedClient" class="client-details">
                <div class="details-header">
                    <div>
                        <h2>{{ selectedClient.firstName }} {{ selectedClient.lastName }}</h2>
                        <p class="client-id">ID: {{ selectedClient.id }}</p>
                    </div>
                    <span class="status-badge-large" [class.inactive]="!selectedClient.isActive">
                        {{ selectedClient.isActive ? 'Activo' : 'Inactivo' }}
                    </span>
                </div>

                <div class="details-section">
                    <h3>Información de Contacto</h3>
                    <div class="contact-info">
                        <div class="info-row">
                            <span class="info-label">Email:</span>
                            <span class="info-value">{{ selectedClient.email }}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Teléfono:</span>
                            <span class="info-value">{{ selectedClient.phone }}</span>
                        </div>
                        <div class="info-row" *ngIf="selectedClient.dateOfBirth">
                            <span class="info-label">Fecha de Nacimiento:</span>
                            <span class="info-value">{{ formatDate(selectedClient.dateOfBirth) }}</span>
                        </div>
                    </div>
                </div>

                <div class="details-section">
                    <h3>Información de Cuenta</h3>
                    <div class="account-info">
                        <div class="info-row">
                            <span class="info-label">Estado:</span>
                            <span class="info-value" [class.active-text]="selectedClient.isActive"
                                [class.inactive-text]="!selectedClient.isActive">
                                {{ selectedClient.isActive ? 'Cuenta Activa' : 'Cuenta Inactiva' }}
                            </span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Fecha de Registro:</span>
                            <span class="info-value">{{ formatDate(selectedClient.createdAt) }}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Última Actualización:</span>
                            <span class="info-value">{{ formatDate(selectedClient.updatedAt) }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>